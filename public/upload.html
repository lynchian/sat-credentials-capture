<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Subir e.firma (FIEL) de forma segura</title>
    <style>
      body { display: grid; place-items: center; min-height: 100vh; margin: 0; background: #0b1020; color: #e2e8f0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      .box { max-width: 640px; width: 100%; padding: 28px; background: rgba(255,255,255,0.04); border: 1px solid rgba(148,163,184,0.15); border-radius: 14px; }
      h1 { margin: 0 0 10px; font-size: 22px; }
      p { margin: 0 0 14px; color: #94a3b8; }
      input, button { font-size: 16px; }
      .row { display: grid; gap: 10px; margin: 12px 0; }
      .msg { min-height: 20px; font-size: 14px; }
      .ok { color: #22c55e; }
      .err { color: #ef4444; }
      a { color: #93c5fd; text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="box">
      <h1>Subir e.firma (FIEL) de forma segura</h1>
      <p>Selecciona tu certificado (.cer), llave privada (.key) y escribe tu contrase침a. Se enviar치n cifrados al servidor y se almacenar치n de forma segura.</p>
      <div class="row">
        <label>Certificado (.cer) <input id="cer" type="file" accept=".cer" /></label>
        <label>Llave privada (.key) <input id="key" type="file" accept=".key" /></label>
        <label>Contrase침a <input id="pwd" type="password" placeholder="********" /></label>
      </div>
      <button id="btn">Subir de forma segura</button>
      <div id="msg" class="msg"></div>
      <p><a href="/">Volver</a></p>
    </div>
    <script>
      const el = (id) => document.getElementById(id);
      el('btn').addEventListener('click', async () => {
        const cer = el('cer').files[0];
        const key = el('key').files[0];
        const pwd = el('pwd').value;
        const msg = el('msg');
        msg.textContent = '';
        if (!cer || !key || !pwd) { msg.textContent = 'Completa todos los campos'; msg.className='msg err'; return; }
        const fd = new FormData();
        fd.append('cer', cer);
        fd.append('key', key);
        fd.append('password', pwd);
        try {
          const resp = await fetch('/api/upload-fiel', { method: 'POST', body: fd });
          const data = await resp.json();
          if (data.ok) { msg.textContent = 'FIEL subida correctamente'; msg.className='msg ok'; }
          else { msg.textContent = data.error || 'Error al subir'; msg.className='msg err'; }
        } catch (e) { msg.textContent = 'Error de red'; msg.className='msg err'; }
      });
    </script>
  </body>
  </html>


